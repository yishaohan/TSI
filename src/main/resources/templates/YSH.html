<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>TEST</title>
</head>
<body>
<div class="form-group">
    <input type="email" required class="form-control form-control-sm" name="email" id="email2" placeholder="Please enter your email">
    <small class="form-text text-muted">We'll never share your email with anyone.</small>
</div>

<!--<div id="smart-button-container1">-->
<!--    <div style="text-align: center;">-->
<!--        <div style="margin-bottom: 1.25rem;">-->
<!--            <select id="item-options">-->
<!--                <option value="50/50 ticket" price="5.00">50/50 ticket - 5.00 CAD</option>-->
<!--            </select>-->
<!--            <select style="visibility: hidden" id="quantitySelect">-->
<!--                <option value="1">1</option>-->
<!--                <option value="2">2</option>-->
<!--                <option value="3">3</option>-->
<!--                <option value="4">4</option>-->
<!--                <option value="5">5</option>-->
<!--                <option value="6">6</option>-->
<!--                <option value="7">7</option>-->
<!--                <option value="8">8</option>-->
<!--                <option value="9">9</option>-->
<!--                <option value="10">10</option>-->
<!--                <option value="11">11</option>-->
<!--                <option value="12">12</option>-->
<!--                <option value="13">13</option>-->
<!--                <option value="14">14</option>-->
<!--                <option value="15">15</option>-->
<!--                <option value="16">16</option>-->
<!--                <option value="17">17</option>-->
<!--                <option value="18">18</option>-->
<!--                <option value="19">19</option>-->
<!--                <option value="20">20</option>-->
<!--            </select>-->
<!--        </div>-->
<!--        <div id="paypal-button-container1"></div>-->
<!--    </div>-->
<!--</div>-->
<div id="smart-button-container2">
    <div style="text-align: center">
        <label for="description">募捐 </label>
        <input type="text" name="descriptionInput" id="description" maxlength="127" value="">
    </div>
    <p id="descriptionError" style="visibility: hidden; color:red; text-align: center;">Please enter a description</p>
    <div style="text-align: center">
        <label for="amount">金额 </label>
        <input name="amountInput" type="number" id="amount" value="">
        <span> CAD</span>
    </div>
    <p id="priceLabelError" style="visibility: hidden; color:red; text-align: center;">Please enter a price</p>
    <div id="invoiceidDiv" style="text-align: center; display: none;">
        <label for="invoiceid"> </label>
        <input name="invoiceid" maxlength="127" type="text" id="invoiceid" value="">
    </div>
    <p id="invoiceidError" style="visibility: hidden; color:red; text-align: center;">Please enter an Invoice ID</p>
    <div style="text-align: center; margin-top: 0.625rem;" id="paypal-button-container2"></div>
</div>
<script
        src="https://www.paypal.com/sdk/js?client-id=AYsnjLgEmwy2RIhy0QdO335NCySWCFKnxecxVmVhTVUxLE8hdw_ZNs1LvGD5sH61BErt2JxRuTc7I9Pn&currency=CAD" data-sdk-integration-source="button-factory">
</script>

<!--<script src="https://www.paypal.com/sdk/js?client-id=sb&currency=CAD" data-sdk-integration-source="button-factory">-->
<!--</script>-->

<!--<script>-->
<!--    function initPayPalButton1() {-->
<!--        var shipping = 0;-->
<!--        var itemOptions = document.querySelector("#smart-button-container1 #item-options");-->
<!--        var quantity = parseInt(20);-->
<!--        var quantitySelect = document.querySelector("#smart-button-container1 #quantitySelect");-->
<!--        if (!isNaN(quantity)) {-->
<!--            quantitySelect.style.visibility = "visible";-->
<!--        }-->
<!--        var orderDescription = '';-->
<!--        if (orderDescription === '') {-->
<!--            orderDescription = 'Item';-->
<!--        }-->
<!--        paypal.Buttons({-->
<!--            style: {-->
<!--                shape: 'pill',-->
<!--                color: 'gold',-->
<!--                layout: 'vertical',-->
<!--                label: 'paypal'-->
<!--            },-->
<!--            onInit: function (data, actions) {-->
<!--                actions.disable();-->
<!--                document.getElementById("email2").addEventListener("focusout", function (event) {-->
<!--                    if (document.getElementById('email2').value == "") {-->
<!--                        actions.disable();-->
<!--                    } else {-->
<!--                        actions.enable();-->
<!--                    }-->
<!--                })-->
<!--            },-->
<!--            onClick: function (data, actions) {-->
<!--                if (document.getElementById('email2').value == "") {-->
<!--                    alert("Please fill in the email address");-->
<!--                }-->
<!--            },-->
<!--            createOrder: function (data, actions) {-->
<!--                var selectedItemDescription = itemOptions.options[itemOptions.selectedIndex].value;-->
<!--                var selectedItemPrice = parseFloat(itemOptions.options[itemOptions.selectedIndex].getAttribute("price"));-->
<!--                var tax = (0 === 0) ? 0 : (selectedItemPrice * (parseFloat(0) / 100));-->
<!--                if (quantitySelect.options.length > 0) {-->
<!--                    quantity = parseInt(quantitySelect.options[quantitySelect.selectedIndex].value);-->
<!--                } else {-->
<!--                    quantity = 1;-->
<!--                }-->
<!--                tax *= quantity;-->
<!--                tax = Math.round(tax * 100) / 100;-->
<!--                var priceTotal = quantity * selectedItemPrice + parseFloat(shipping) + tax;-->
<!--                priceTotal = Math.round(priceTotal * 100) / 100;-->
<!--                var itemTotalValue = Math.round((selectedItemPrice * quantity) * 100) / 100;-->
<!--                return actions.order.create({-->
<!--                    purchase_units: [{-->
<!--                        description: orderDescription,-->
<!--                        amount: {-->
<!--                            currency_code: 'CAD',-->
<!--                            value: priceTotal,-->
<!--                            breakdown: {-->
<!--                                item_total: {-->
<!--                                    currency_code: 'CAD',-->
<!--                                    value: itemTotalValue,-->
<!--                                },-->
<!--                                shipping: {-->
<!--                                    currency_code: 'CAD',-->
<!--                                    value: shipping,-->
<!--                                },-->
<!--                                tax_total: {-->
<!--                                    currency_code: 'CAD',-->
<!--                                    value: tax,-->
<!--                                }-->
<!--                            }-->
<!--                        },-->
<!--                        items: [{-->
<!--                            name: selectedItemDescription,-->
<!--                            unit_amount: {-->
<!--                                currency_code: 'CAD',-->
<!--                                value: selectedItemPrice,-->
<!--                            },-->
<!--                            quantity: quantity-->
<!--                        }]-->
<!--                    }]-->
<!--                });-->
<!--            },-->
<!--            onApprove: function (data, actions) {-->
<!--                return actions.order.capture().then(function (details) {-->
<!--                    var id = details.id;-->
<!--                    // var intent = details.intent;-->
<!--                    // var status = details.status;-->
<!--                    // // var links = details.links[0].rel;-->
<!--                    // var createTime = details.create_time;-->
<!--                    // var updateTime = details.update_time;-->
<!--                    // var payerID = details.payer.payer_id;-->
<!--                    // var payerGivenName = details.payer.name.given_name;-->
<!--                    // var payerSurname = details.payer.name.surname;-->
<!--                    // var payerEmail = details.payer.email_address;-->
<!--                    // var quantity = details.purchase_units[0].items[0].quantity;-->
<!--                    // console.log(quantity);-->
<!--                    // fetch(`/captureOrder?id=${id}&intent=${intent}&status=${status}&createTime=${createTime}&updateTime=${updateTime}&payerID=${payerID}&payerGivenName=${payerGivenName}&payerSurname=${payerSurname}&payerEmail=${payerEmail}&quantity=${quantity}`), {}-->
<!--                    var email = document.getElementById("email2").value;-->
<!--                    fetch(`/captureOrder?id=${id}&email=${email}`, {}).then(function () {-->
<!--                        // alert("You have made the transaction. Thank you for your support !");-->
<!--                        window.location.reload();-->
<!--                    });-->
<!--                });-->
<!--            },-->
<!--            onCancel: function (data) {-->
<!--                fetch(`/orderCancel?message=Order is ${data.orderID} cancelled !`, {}).then(function () {-->
<!--                    alert("You canceled the payment order !");-->
<!--                });-->
<!--            },-->
<!--            onError: function (err) {-->
<!--                fetch(`/orderError?message=${err.message}`, {}).then(function () {-->
<!--                    alert("There was an error in payment, please try again !");-->
<!--                });-->
<!--            }-->
<!--        }).render('#paypal-button-container1');-->
<!--    }-->

<!--    initPayPalButton1();-->
<!--</script>-->

<script>
    function initPayPalButton2() {
        var description = document.querySelector('#smart-button-container2 #description');
        var amount = document.querySelector('#smart-button-container2 #amount');
        var descriptionError = document.querySelector('#smart-button-container2 #descriptionError');
        var priceError = document.querySelector('#smart-button-container2 #priceLabelError');
        var invoiceid = document.querySelector('#smart-button-container2 #invoiceid');
        var invoiceidError = document.querySelector('#smart-button-container2 #invoiceidError');
        var invoiceidDiv = document.querySelector('#smart-button-container2 #invoiceidDiv');

        var elArr = [description, amount];

        if (invoiceidDiv.firstChild.innerHTML.length > 1) {
            invoiceidDiv.style.display = "block";
        }

        var purchase_units = [];
        purchase_units[0] = {};
        purchase_units[0].amount = {};

        function validate(event) {
            return event.value.length > 0;
        }

        paypal.Buttons({
            style: {
                color: 'gold',
                shape: 'pill',
                label: 'paypal',
                layout: 'vertical',

            },

            onInit: function (data, actions) {
                actions.disable();

                if (invoiceidDiv.style.display === "block") {
                    elArr.push(invoiceid);
                }

                elArr.forEach(function (item) {
                    item.addEventListener('keyup', function (event) {
                        var result = elArr.every(validate);
                        if (result) {
                            actions.enable();
                        } else {
                            actions.disable();
                        }
                    });
                });
            },

            onClick: function () {
                if (description.value.length < 1) {
                    descriptionError.style.visibility = "visible";
                } else {
                    descriptionError.style.visibility = "hidden";
                }

                if (amount.value.length < 1) {
                    priceError.style.visibility = "visible";
                } else {
                    priceError.style.visibility = "hidden";
                }

                if (invoiceid.value.length < 1 && invoiceidDiv.style.display === "block") {
                    invoiceidError.style.visibility = "visible";
                } else {
                    invoiceidError.style.visibility = "hidden";
                }

                purchase_units[0].description = description.value;
                purchase_units[0].amount.value = amount.value;

                if (invoiceid.value !== '') {
                    purchase_units[0].invoice_id = invoiceid.value;
                }
            },

            createOrder: function (data, actions) {
                return actions.order.create({
                    purchase_units: purchase_units,
                });
            },

            onApprove: function (data, actions) {
                return actions.order.capture().then(function (details) {
                    alert('Transaction completed by ' + details.payer.name.given_name + '!');
                });
            },

            onError: function (err) {
                console.log(err);
            }
        }).render('#paypal-button-container2');
    }

    initPayPalButton2();
</script>
</body>
</html>